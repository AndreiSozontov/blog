---
layout: post
title: Exceptions. Как не надо делать
description: Exceptions. Anti-patterns
summary: Exceptions. Anti-patterns
comments: true
tags: [csharp, anti-patterns&pitfalls]
---

_страница в работе_

Я уже упоминал [в первом посте](https://andreisozontov.netlify.app/2019/11/05/exceptions-best-practices), что не следует выбрасывать общие и системные исключения: _Exception_, _SystemException_, _ApplicationException_, _IndexOutOfRangeException_, _NullReferenceException_, _OutOfMemoryException_ и _ExecutionEngineException_:
1. Они либо слишком общие и мало говорят о том, что случилось (_Exception_, _SystemException_, _ApplicationException_)
2. Либо, как в случае с остальными (_IndexOutOfRangeException_, _NullReferenceException_ и т.д.), выбрасывать такие исключения должна сама платформа, а не пользовательский код, иначе затрудняется понимание причин, вызвавших исключение.

Однако захотелось написать отдельный пост, в котором описать еще пару примеров того, как не следует работать с исключениями, кратко поясняя почему.

Есть ряд очевидных рекомендаций, как например:
- Блок catch должен делать что-то еще, кроме пробрасывания исключения выше;
- Не следует генерировать исключения в блоке finally, т.к. его предназначение заключается совсем в другом;

Но есть и ряд не совсем очевидных:

### Генерировать исключения там, где это не ожидается
Плохой пример:
```csharp
public override string ToString()
{
    if (string.IsNullOrEmpty(Name))
    {
        throw new ArgumentNullException(nameof(Name));
    }
```

Есть ряд методов и мест, в которых не следует генерировать и выбрасывать исключения, т.к. ожидается, что эти методы должны просто нормально работать. Тот факт, что эти простые операции могут неожиданно прерывать свою работу генерацией исключения является неприемлимым.

Вот список таких мест/методов:
- Object.Equals
- IEquatable.Equals
- GetHashCode
- ToString
- статические конструкторы
- IDisposable.Dispose
- операторы ==, !=, <, >, <=, >=
- операторы неявного приведения
- методы get свойств класса

Делайте, что угодно, но не генерируйте там исключения. Вынесите проверку куда-то туда, где ей место. Добейтесь того, чтобы ваш код гарантировал, что в перечисленные выше методы не попадут некорректные данные и они будут просто работать, как от них и ожидается.