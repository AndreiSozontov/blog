---
layout: post
title: Асинхронное программирование. Часть 1 - Основы
description: Общие сведения об асинхронном программировании. Ключевые слова async, await и тип Task
summary: Общие сведения об асинхронном программировании. Ключевые слова async, await и тип Task
comments: true
tags: [csharp]
---

_страница в работе_

Объективная реальность асинхронна. Мы можем поставить кипятиться воду в чайнике и не обязаны стоять рядом с ним и сосредоточенно ждать, пока вскипит вода, при этом ничего не делая. Пока вода кипятится, мы можем уйти почисть зубы, например, и вернуться к чайнику позже, когда он подаст нам сигнал (callback), что его пора выключать или даже выключится сам. Собственно, в веб-разработке, например, когда наше приложение получает входящий запрос, то поток, выделенный для него из пула потоков (Thread Pool) доходит до такой асинхронной операции и не стоит и ждет ее завершения, а возвращается обратно в Thread Pool. За счет этого увеличивается масштабируемость, т.к. поток, вернувшийся в пул потоков, может делать что-то еще, например обрабатывать новый входящий запрос.

Безусловно, если ваше приложение/сервис не является высоконагруженным, то никакого преимущества вы не получите: ни чуть не хуже асинхронных у вас будут работать и синхронные операции. Кроме того некоторые (но крайне несущественные) накладные расходы несет необходимость менять состоянии Task'и, возврата/выделения потоков из пула и т.д. Тем не менее, Microsoft дает очень простую рекомендацию: _используйте асинхронное программирование везде, где это возможно_.

## Ключевые слова async и await
Ключевое слово `async` добавляется при объявлении метода и указывает, что данный метод асинхронный, следовательно внутри него нам как минимум один раз должно встретиться ключевое слово `await`. 

Такой асинхронный метод должен иметь тип `Task<TResult>`, если он возвращает какое-то значение, либо иметь тип `Task`, если он ничего не возвращает.

```
public async Task FindAnswerAsync()
{
    int answer = 42;

    // Асинхронно подождать 10 секунд.
    await Task.Delay(TimeSpan.FromSeconds(10));

    Trace.WriteLine(answer.ToString());
}
```

Следует избегать `async void`, даже если метод ничего не возврщает, он должен иметь тип `Task`!
